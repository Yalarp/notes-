# Day 1: JDBC (Java Database Connectivity)

## 1. Introduction to JDBC
**JDBC** stands for **Java Database Connectivity**. It allows Java applications to connect to any relational database (MySQL, Oracle, SQL Server, etc.) and perform operations like retrieving, updating, adding, and deleting records.

### JDBC Components
1.  **JDBC API**: A set of classes and interfaces (in `java.sql` package) that remains consistent regardless of the underlying database.
2.  **JDBC Driver**: Implementation of the JDBC API that communicates with a specific database server.

---

## 2. JDBC Architecture & Drivers
There are 4 types of JDBC drivers:

1.  **Type 1 (JDBC-ODBC Bridge)**:
    *   Requires ODBC drivers installed on the client machine.
    *   **Obsolete** (removed in Java 8).
2.  **Type 2 (Native-API Driver)**:
    *   Requires database client libraries to be installed on the client machine.
    *   Cannot be used for pure Java/Internet apps.
3.  **Type 3 (Network-Protocol Driver)**:
    *   Uses middleware (Application Server) to convert JDBC calls to the database protocol.
    *   Flexible but requires middleware.
4.  **Type 4 (Thin Driver)**:
    *   **Fastest**. Directly connects to the database using the database's native protocol.
    *   Written entirely in Java. No client-side software needed.
    *   **Driver for this batch**: `com.mysql.cj.jdbc.Driver` (MySQL Connector/J).

---

## 3. Steps to Connect to a Database
The standard flow for a JDBC application is:

1.  **Load and Register the Driver**:
    *   Class: `com.mysql.cj.jdbc.Driver`
    *   (In modern JDBC, drivers are often autoloaded via SPI, but `Class.forName()` is the traditional way).
2.  **Get Connection**:
    *   Use `DriverManager.getConnection(url, username, password)`.
    *   **URL Format**: `jdbc:mysql://localhost:3306/mydb`
3.  **Create Statement**:
    *   Create an object to execute SQL queries.
    *   `Statement st = con.createStatement();`
4.  **Execute Query**:
    *   **DDL/DML (Insert, Update, Delete)**: `st.executeUpdate(sql)` -> returns `int` (row count).
    *   **Select**: `st.executeQuery(sql)` -> returns `ResultSet`.
5.  **Process Results**:
    *   Iterate through `ResultSet`.
6.  **Close Resources**:
    *   Close `ResultSet`, `Statement`, and `Connection`.

### Example Code (Basic Select)
```java
import java.sql.*;

public class App1 {
    public static void main(String args[]) {
        String url = "jdbc:mysql://localhost:3306/mydb";
        // Try-with-resources auto-closes the connection
        try(Connection con = DriverManager.getConnection(url, "root", "root")) {
            System.out.println("Connected: " + con.getClass()); 
            
            Statement st = con.createStatement();
            ResultSet rs = st.executeQuery("select * from dept");
            
            while(rs.next()) {
                int no = rs.getInt("deptno");
                String name = rs.getString("dname");
                String loc = rs.getString("loc");
                System.out.println(no + "\t" + name + "\t" + loc);
            }
        } catch(Exception e) {
            System.out.println(e);
        }
    }
}
```

---

## 4. JDBC Interfaces
Key interfaces in `java.sql` package (for loosely coupling):
*   **Driver**: Interface that every driver class must implement.
*   **Connection**: Represents a session with the database.
*   **Statement**: Used for executing static SQL statements.
*   **PreparedStatement**: Used for precompiled SQL statements (faster, safer).
*   **CallableStatement**: Used to execute stored procedures.
*   **ResultSet**: Represents the table of data generated by a query.
*   **ResultSetMetaData**: Information about the columns in a `ResultSet`.
*   **DatabaseMetaData**: Information about the database itself (tables, version, etc.).

---

## 5. Statement vs. PreparedStatement

| Feature | Statement | PreparedStatement |
| :--- | :--- | :--- |
| **Compilation** | SQL is parsed/compiled every time it runs. | SQL is parsed/compiled **once** and cached. |
| **Performance** | Slower for repeated execution. | **Faster** for repeated execution with different params. |
| **Parameters** | Hard to handle dynamic values (string concatenation). | Easy placeholders using `?` (e.g., `VALUES(?, ?)`). |
| **Security** | Vulnerable to **SQL Injection**. | immune to **SQL Injection** (values are escaped automatically). |

### PreparedStatement Example
```java
String sql = "update dept set loc=? where deptno=?";
PreparedStatement pst = con.prepareStatement(sql);

pst.setString(1, "Delhi"); // 1st question mark
pst.setInt(2, 10);         // 2nd question mark

int rowsAffected = pst.executeUpdate();
```

---

## 6. Transactions
By default, JDBC is in **Auto-Commit** mode (every SQL statement is committed immediately).
To handle transactions (ACID properties):
1.  **Start Transaction**: `con.setAutoCommit(false);`
2.  **Commit**: `con.commit();` (Save changes)
3.  **Rollback**: `con.rollback();` (Undo changes if an error occurs)

### Transaction Example
```java
try {
    con.setAutoCommit(false); // Start transaction
    
    Statement st = con.createStatement();
    st.executeUpdate("update dept set loc='Mumbai' where deptno=10");
    st.executeUpdate("insert into dept values(20, 'HR', 'Pune')");
    
    con.commit(); // Save all changes
} catch(Exception e) {
    con.rollback(); // Undo if any step failed
} finally {
    con.setAutoCommit(true); // Restore default
}
```

---

## 7. Advanced Concepts

### SQL Injection
A security vulnerability where attackers interfere with queries by injecting malicious SQL code via input fields.
*   **Example**: Inputting `' OR '1'='1` in a login field.
*   **Prevention**: Always use `PreparedStatement` instead of concatenating strings.

### CachedRowSet (Disconnected RowSet)
A `RowSet` that is disconnected from the database. It caches data in memory, allowing you to work with it without keeping the connection open.
*   **Benefit**: Reduces database load; useful for passing data between layers or over a network.
*   **Usage**: `CachedRowSet` implementation (e.g., from `javax.sql.rowset`).

### ResultSet Navigation
*   `rs.next()`: Moves cursor forward one row. Returns `false` when no more rows.
*   `rs.previous()`: Moves cursor backward (if ResultSet is scrollable).
*   `rs.absolute(int row)`: Moves cursor to specific row number.
*   **Scrollable & Updatable**:
    ```java
    Statement st = con.createStatement(
        ResultSet.TYPE_SCROLL_SENSITIVE, 
        ResultSet.CONCUR_UPDATABLE
    );
    ```

---

## Summary
*   **JDBC** allows Java apps to interact with DBs.
*   **Type 4 Driver** is the standard for Java app connectivity.
*   Always favor **PreparedStatement** over **Statement** for security and performance.
*   Use **Transactions** (`commit`/`rollback`) for atomic operations.
*   **CachedRowSet** enables disconnected data processing.
